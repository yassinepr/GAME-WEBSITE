<!doctypehtml><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><title>TriskaidekaPool</title><style>*{padding:0;margin:0}body{touch-action:none;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#000;cursor:crosshair}#score{pointer-events:none;color:#fff;height:1rem}#cnvs{width:max(320px,min(80vw,80vh));height:max(320px,min(80vw,80vh));background:#408323;background:radial-gradient(circle,#408323 0,#408323 46%,#134918 100%);border:1px solid #000;transition:.1s}#cnvs.shake{margin-left:20px}#out{display:flex;justify-content:center;pointer-events:none;height:1rem}#out>div{font-size:14px;width:15px;height:15px;text-align:center;border-radius:50%}</style><div id=score></div><canvas id=cnvs></canvas><div id=out></div><script>"use strict";let zzfxV=.3,zzfxX=new AudioContext,zzfx=(s=1,e=.05,t=220,i=0,c=0,h=.1,n=0,X=1,o=0,w=0,R=0,u=0,l=0,q=0,a=0,O=0,r=0,f=1,m=0,d=0,D=0)=>{let W=Math,p=2*W.PI,v=44100,T=o*=500*p/v/v,z=t*=(1-e+2*e*W.random(e=[]))*p/v,V=0,A=0,x=0,g=1,N=0,j=0,y=0,b=D<0?-1:1,P=p*b*D*2/v,I=W.cos(P),M=W.sin,F=M(P)/4,k=1+F,E=-2*I/k,H=(1-F)/k,G=(1+b*I)/2/k,J=-(b+I)/k,K=G,C=0,S=0,B=0,L=0;i=v*i+9;m*=v;c*=v;h*=v;r*=v;w*=500*p/v**3;a*=p/v;R*=p/v;u*=v;l=v*l|0;s*=zzfxV;for(b=i+m+c+h+r|0;x<b;e[x++]=y*s)++j%(100*O|0)||(y=n?1<n?2<n?3<n?M(V**3):W.max(W.min(W.tan(V),1),-1):1-(2*V/p%2+2)%2:1-4*W.abs(W.round(V/p)-V/p):M(V),y=(l?1-d+d*M(p*x/l):1)*(y<0?-1:1)*W.abs(y)**X*(x<i?x/i:x<i+m?1-(x-i)/m*(1-f):x<i+m+c?f:x<b-r?(b-x-r)/h*f:0),y=r?y/2+(r>x?0:(x<b-r?1:(b-x)/r)*e[x-r|0]/2/s):y,D?y=L=K*C+J*(C=S)+G*(S=y)-H*B-E*(B=L):0),P=(t+=o+=w)*W.cos(a*A++),V+=P+P*q*M(x**5),g&&++g>u&&(t+=R,z+=R,g=0),!l||++N%l||(t=z,o=T,g=g||1);s=zzfxX.createBuffer(1,b,v);s.getChannelData(0).set(e);t=zzfxX.createBufferSource();t.buffer=s;t.connect(zzfxX.destination);t.start()};const cnvs=document.getElementById("cnvs");const outDiv=document.getElementById("out");const scoreDiv=document.getElementById("score");const W=cnvs.getBoundingClientRect().width;const R=W/32;const D=R*2;cnvs.width=cnvs.height=W;const c=cnvs.getContext("2d");const PI=Math.PI;let out=[];let limit=0;const swatch=document.createElement("canvas");const sw=swatch.getContext("2d",{t:true});swatch.width=D*7;swatch.height=D;sw.strokeStyle="white";sw.lineWidth=R/10;sw.beginPath();sw.arc(R,R,R*.9,0,PI*2);sw.stroke();sw.closePath();sw.beginPath();sw.moveTo(R+R*.7,R-R*.7);sw.lineTo(R-R*.7,R+R*.7);sw.moveTo(R-R*.7,R-R*.7);sw.lineTo(R+R*.7,R+R*.7);sw.stroke();sw.closePath();sw.beginPath();sw.arc(D+R,R,R*.9,0,PI*2);sw.stroke();sw.closePath();sw.beginPath();sw.arc(D+R,R,1,0,PI*2);sw.stroke();sw.closePath();sw.beginPath();sw.arc(D*2+R*.8,R,R*.2,0,PI);sw.arc(D*2+R,R,R*.4,PI,0);sw.arc(D*2+R*.8,R,R*.6,0,PI);sw.arc(D*2+R,R,R*.8,PI,0);sw.arc(D*2+R*.8,R,R,0,PI/4);sw.stroke();sw.closePath();sw.beginPath();sw.arc(D*3+R,R,R*.8,0,PI*2);sw.stroke();sw.closePath();sw.beginPath();sw.moveTo(D*3+R,0);sw.lineTo(D*3+R*.8,R);sw.lineTo(D*3+R*1.2,R);sw.lineTo(D*3+R,D);sw.stroke();sw.closePath();sw.beginPath();sw.arc(D*4+R,R,R*.9,0,PI*2);sw.moveTo(D*4,R);sw.lineTo(D*4+R/2,R);sw.lineTo(D*4+R*.8,R-R*.6);sw.lineTo(D*4+R*1.2,R+R*.6);sw.lineTo(D*4+R*1.5,R);sw.lineTo(D*5-1,R);sw.stroke();sw.closePath();sw.beginPath();sw.moveTo(D*5,R/4);sw.lineTo(D*6-1,R/4);sw.lineTo(D*5+R,D-R/5);sw.lineTo(D*5,R/4);sw.stroke();sw.closePath();sw.beginPath();sw.arc(D*6+R,R,R/2.5,0,PI*2);sw.stroke();sw.closePath();sw.beginPath();sw.arc(D*6+R,R,R*.8,PI*-1.2,PI*-1.5);sw.moveTo(D*6,R*1.4);sw.lineTo(D*6+R*.4,R*1.6);sw.lineTo(D*6+R*.5,R*1.2);sw.stroke();sw.closePath();const colors=["red","lime","plum","gold","tan","coral","blue","blue","coral","tan","gold","plum","lime","red"];class Vec2{constructor(s,e){this.x=s?s:0;this.y=e?e:0}add(s){if(typeof s==="number"){this.x+=s;this.y+=s}else{this.x+=s.x;this.y+=s.y}return this}i(s){if(typeof s==="number"){this.x-=s;this.y-=s}else{this.x-=s.x;this.y-=s.y}return this}div(s){if(typeof s==="number"){this.x/=s;this.y/=s}else{this.x/=s.x;this.y/=s.y}return this}h(s){if(typeof s==="number"){this.x*=s;this.y*=s}else{this.x*=s.x;this.y*=s.y}return this}o(){return new Vec2(this.x,this.y)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}R(){let s=this.length();return this.div(s)}u(s){return Math.sqrt((this.x-s.x)*(this.x-s.x)+(this.y-s.y)*(this.y-s.y))}}const drawRunes=s=>{c.save();c.globalCompositeOperation="overlay";if(s.type==="013"){c.putImageData(sw.getImageData(0,0,D,D),s.l.x-R,s.l.y-R)}else if(s.type==="112"){c.putImageData(sw.getImageData(D,0,D,D),s.l.x-R,s.l.y-R)}else if(s.type==="211"){c.putImageData(sw.getImageData(D*2,0,D,D),s.l.x-R,s.l.y-R)}else if(s.type==="310"){c.putImageData(sw.getImageData(D*3,0,D,D),s.l.x-R,s.l.y-R)}else if(s.type==="49"){c.putImageData(sw.getImageData(D*4,0,D,D),s.l.x-R,s.l.y-R)}else if(s.type==="58"){c.putImageData(sw.getImageData(D*5,0,D,D),s.l.x-R,s.l.y-R)}else if(s.type==="67"){c.putImageData(sw.getImageData(D*6,0,D,D),s.l.x-R,s.l.y-R)}c.restore()};class Rune{constructor(s,e){this.l=s;this.type=e;this.m=3+out.length}D(){drawRunes(this)}}class Ball{constructor(s,e,t,i){this.W=s;this.l=e;this.p=i;this.v=t;this.V=false;this.g=0}update(){if(this.v.x!==0&&this.v.y!==0){this.V=true}if(!this.V){return}let s=this.l.add(this.v);if(s.x<R||s.x>W-R||s.y<R||s.y>W-R){this.P=false;zzfx(1,.05,110,0,0,.1,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0)}if(s.x<=R){this.l.x=R;this.v.x*=-1}if(s.x>=W-R){this.l.x=W-R;this.v.x*=-1}if(s.y<=R){this.l.y=R;this.v.y*=-1}if(s.y>=W-R){this.l.y=W-R;this.v.y*=-1}if(this.g>0){this.g--}this.v=this.v.h(.99);if(this.v.length()<.003){this.stop()}this.l=this.l.add(this.v)}stop(){this.P=false;this.V=false;this.v=new Vec2(0,0)}I(){let s=this.l;c.beginPath();c.fillStyle="#00000088";c.arc(s.x+(s.x-W/2)/(W/20),s.y+(s.y-W/2)/(W/20),R*1.1,0,PI*2);c.fill();c.closePath()}D(){let s=this.l;c.beginPath();c.fillStyle=this.p;c.arc(s.x,s.y,R,0,PI*2);c.fill();c.closePath();c.beginPath();c.fillStyle="#FFFFFF99";c.arc(s.x-(s.x-W/2)/(W/R),s.y-(s.y-W/2)/(W/R),R/2.5,0,PI*2);c.fill();c.closePath();c.beginPath();c.font=R*1.2+"px sans-serif";c.textAlign="center";c.fillStyle="black";c.fillText(this.W,s.x,s.y+R/2);c.closePath();if(this.W===out.length){c.save();c.beginPath();c.strokeStyle="white";c.arc(s.x,s.y,R*1.4,0,PI*2);c.setLineDash([1,2]);c.stroke();c.closePath();c.restore()}}}class Game{constructor(){this.M=[];this.F=[];this.k={start:undefined};this.G=[new Vec2(0,0),new Vec2(W/2,0),new Vec2(W,0),new Vec2(0,W/2),new Vec2(W,W/2),new Vec2(0,W),new Vec2(W/2,W),new Vec2(W,W)];this.C=0;this.S=false}start(){this.B();const s=W/30;c.save();c.fillStyle="white";c.strokeStyle="white";c.font=s-1+"px sans-serif";c.textAlign="center";c.fillText("TriskaidekaPool",W/2,s*1.5);c.fillText("1. Balls should be scored in order 0,1,2,..13",W/2,s*3);c.fillText("No points gained otherwise",W/2,s*4);c.fillText("Next ball will be highlighted if possible",W/2,s*5);c.fillText("2. If two balls collide, and their sum equals 13,",W/2,s*7);c.fillText("special runes will appear on the table",W/2,s*8);c.fillText("3. Runes will vanish after number of uses",W/2,W-s*4);c.fillText("Click to start",W/2,W-s*2);drawRunes({l:{x:W*.25,y:s*10},type:"013"});drawRunes({l:{x:W*.25,y:s*12},type:"112"});drawRunes({l:{x:W*.25,y:s*14},type:"211"});drawRunes({l:{x:W*.25,y:s*16},type:"310"});drawRunes({l:{x:W*.25,y:s*18},type:"49"});drawRunes({l:{x:W*.25,y:s*20},type:"58"});drawRunes({l:{x:W*.25,y:s*22},type:"67"});c.textAlign="left";c.fillText("0+13 Repel the ball away",W*.25+D,s*10.4);c.fillText("1+12 Stop all balls",W*.25+D,s*12.4);c.fillText("2+11 Teleport the ball randomly",W*.25+D,s*14.4);c.fillText("3+10 Give the ball speed boost",W*.25+D,s*16.4);c.fillText("4+9 Shake the table",W*.25+D,s*18.4);c.fillText("5+8 Pushes the ball to random socket",W*.25+D,s*20.4);c.fillText("6+7 Return last ball to play",W*.25+D,s*22.4);c.restore()}init(){this.C=0;this.X();this.M=[new Ball(" ",new Vec2(W/2,D*3),new Vec2(0,0),"lightgray")];for(let s=0,e=1,t=2;s<14;s++,e++){this.M.push(new Ball(s,new Vec2(W/2-R-t*R+e*(D+1),W/2+t*D),new Vec2(0,0),colors[s]));if(e===t){e=0;t++}}}q(){this.M=[];this.F=[];out=[];this.O();c.fillText("Game Over",W/2,W/2-D);c.fillText("Final score: "+this.C,W/2,W/2+D)}X(){scoreDiv.innerText=this.C}T(s,e){if(!s.V&&!e.V){return}const t=s.W+e.W===13;let i=s.l.add(s.v);let c=e.l.add(e.v);var h=i.u(c);if(h<D){if(s.g===0&&e.g===0){zzfx(1.1,.05,20,0,0,.04,1,1,-1.1,0,0,0,0,1,1,0,0,.48,0,0,656);if(t){if([0,13].includes(s.W)){this.F.push(new Rune(this.A(),"013"))}else if([1,12].includes(s.W)){this.F.push(new Rune(this.A(),"112"))}else if([2,11].includes(s.W)){this.F.push(new Rune(this.A(),"211"))}else if([3,10].includes(s.W)){this.F.push(new Rune(this.A(),"310"))}else if([4,9].includes(s.W)){this.F.push(new Rune(this.A(),"49"))}else if([5,8].includes(s.W)){this.F.push(new Rune(this.A(),"58"))}else if([6,7].includes(s.W)){this.F.push(new Rune(this.A(),"67"))}}s.g=e.g=2}const n=s.v.o();s.v=s.v.add(new Vec2(s.l.x-e.l.x,s.l.y-e.l.y).R().h(s.v.length()/3));e.v=e.v.add(new Vec2(e.l.x-s.l.x,e.l.y-s.l.y).R().h(n.length()/3))}}N(e){if(e.P){return}const s=this.F.find(s=>s.l.u(e.l)<R*1.5);s&&s.m--;if(s){e.P=true}if(s?.type==="67"){if(e.V){zzfx(1,.05,473,.02,.11,.19,1,3,0,0,50,.09,.03,0,0,0,0,.89,.14,.14,0)}if(out.at(-1)){const e=out.at(-1);e.l=this.A();e.v=new Vec2(0,0);this.M.splice(e.W+1,0,e);out.pop();this.O()}}else if(s?.type==="310"){if(e.V){zzfx(1.1,.05,783,.28,.02,.01,3,4,0,-6,25,0,.02,0,8,0,0,.73,0,.06,0)}e.v=e.v.h(2)}else if(s?.type==="211"){if(e.V){zzfx(2.1,.05,618,.06,.28,.5,0,2.2,0,0,-113,.06,.02,0,0,0,0,.75,.17,.1,632)}e.l=new Vec2(Math.random()*(W-D)+R,Math.random()*(W-D)+R)}else if(s?.type==="49"){if(e.V){zzfx(1.1,.05,41,.07,.18,.5,3,2.9,-1,0,0,0,.06,.6,0,.9,0,.42,.05,.38,0)}cnvs.classList.toggle("shake");setTimeout(()=>cnvs.classList.toggle("shake"),100);this.M.forEach(s=>s.v.add(new Vec2(Math.random()*.2-.1,Math.random()*.2-.1)))}else if(s?.type==="013"){if(e.V){zzfx(1.3,.05,100,.01,0,.16,1,2.8,-3,0,0,0,0,1,0,.3,0,.52,.01,0,0)}e.v=e.v.add(new Vec2(e.l.x-s.l.x,e.l.y-s.l.y).R().h(e.v.length()))}else if(s?.type==="112"){if(e.V){zzfx(1,.05,360,.01,.27,.28,0,2.3,0,0,0,0,.08,0,24,0,0,.97,.23,0,0)}this.M.forEach(s=>s.v=new Vec2(0,0))}else if(s?.type==="58"){if(e.V){zzfx(.7,.05,237,.05,.28,.15,0,3.6,0,114,0,0,.09,0,9.9,0,0,.76,.21,0,122)}const t=this.G[Math.round(Math.random()*120)%6];e.v=new Vec2(t.x-e.l.x,t.y-e.l.y).R()}}A(){limit++;const e=new Vec2(Math.random()*(W-D)+R,Math.random()*(W-D)+R);const s=this.M.every(s=>!out.includes(s)&&s.l.u(e)>D*2)&&this.F.every(s=>s.l.u(e)>D*2)||limit>100?e:this.A();limit=0;return s}O(){outDiv.innerHTML="";out.forEach((s,e)=>{const t=document.createElement("div");t.style.background=s.W===e?s.p:"#555";t.innerText=s.W;outDiv.appendChild(t)})}update(){if(out.length===14){this.S=false;this.q();return}this.M.forEach(e=>{e.update();this.N(e);if(!e.V||out.includes(e)){return}if(this.G.some(s=>e.l.u(s)<R*1.6)){if(e.W!==" "){out.push(e);this.O();zzfx(5,.05,428,.02,.06,.15,1,.8,0,0,359,.04,.05,0,0,.1,0,.93,.02,0,-505);this.C=out.reduce((s,e,t)=>{return e.W===t?s+e.W+1:s+0},0);this.X();this.M.splice(this.M.indexOf(e),1);e.stop()}else{zzfx(1,.05,326,0,.2,.007,0,1.4,18,0,-230,.02,0,0,75,0,0,.57,.08,0,0);e.v=new Vec2(0,0);e.l=this.A()}}});for(let e=0;e<this.M.length;e++){for(let s=0;s<this.M.length;s++){if(e===s){continue}this.T(this.M[e],this.M[s])}}this.F.forEach((s,e)=>{if(s.m<1){this.F.splice(e,1)}})}B(){c.save();c.fillStyle="black";c.strokeStyle="gold";c.strokeRect(0,0,W,W);this.G.forEach(s=>{c.beginPath();c.moveTo(s.x,s.y);c.arc(s.x,s.y,R*1.3,0,PI*2);c.fill();c.closePath()});c.restore()}j(){if(this.k.start){c.save();c.beginPath();c.moveTo(this.k.start.x,this.k.start.y);c.lineTo(this.M[0].l.x,this.M[0].l.y);c.strokeStyle="white";c.setLineDash([5,5]);c.stroke();c.closePath();c.restore()}}D(){c.clearRect(0,0,W,W);this.F.forEach(s=>s.D());this.B();this.M.forEach(s=>s.I());this.j();this.M.forEach(s=>s.D())}}const game=new Game;const mousedown=()=>{if(game.M.some(s=>s.V)){return}game.k.start=new Vec2(event.clientX-cnvs.offsetLeft,event.clientY-cnvs.offsetTop);document.body.addEventListener("mousemove",mousemove);document.body.addEventListener("mouseup",mouseup)};const mousemove=s=>{game.k.start=new Vec2(s.clientX-cnvs.offsetLeft,s.clientY-cnvs.offsetTop)};const mouseup=s=>{const e=new Vec2(s.clientX-cnvs.offsetLeft-game.M[0].l.x,s.clientY-cnvs.offsetTop-game.M[0].l.y);const t=e.length()/W;game.M[0].v=e.R().h(Math.min(t,1)+out.length/13);game.k.start=undefined;document.body.removeEventListener("mousemove",mousemove);document.body.removeEventListener("mouseup",mouseup)};const gameCycle=()=>{if(game.S){game.update();game.D();requestAnimationFrame(gameCycle)}else{document.body.addEventListener("mousedown",launchGame);document.body.removeEventListener("mousemove",mousemove);document.body.removeEventListener("mouseup",mouseup);game.q()}};const launchGame=()=>{game.init();document.body.removeEventListener("mousedown",launchGame);document.body.addEventListener("mousedown",mousedown);game.S=true;gameCycle()};document.body.addEventListener("mousedown",launchGame);game.start();</script>